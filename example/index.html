<html>
    <head>
        <title>Tomcar Example</title>

        <link rel="stylesheet" href="css/main.css" type="text/css" data-for="result">

        <script type="text/javascript" src="./js/vue.min.js"></script>
        <script type="text/javascript" src="./js/require.js"></script>
        <script type="text/javascript" src="./js/map.js"></script>
        <script type="text/javascript" src="./js/tomcar.js"></script>

        <script type="text/javascript">

            window.onload=function () {

                // requirejs 配置
                require.config({
                    paths:{
                    'vue':'./js/vue.min',
                    }
                });
            
                // 画布配置
                const width = 500;
                const height = 500;

                let mainCanvas=document.getElementById('main-canvas');
                let gd=mainCanvas.getContext('2d'); //图形上下文——绘图接口

                // 设置监听器
                let lastX,lastY;
                mainCanvas.onmousedown=function (ev) {
            
                    lastX=ev.offsetX;
                    lastY=ev.offsetY;
                
                    mainCanvas.onmousemove=function (ev) {
                        gd.beginPath();//清除之前所有的路径
                            
                        gd.moveTo(lastX,lastY);
                        gd.lineTo(ev.offsetX,ev.offsetY);
                    
                        lastX=ev.offsetX;
                        lastY=ev.offsetY;
                    
                        gd.strokeStyle="red";//用获取到的颜色作为绘制颜色
                        gd.stroke();
                
                    }

                    mainCanvas.onmouseup=function () {
                        mainCanvas.onmousemove=null;
                        mainCanvas.onmouseup=null;
                    } 
                }

                // 绘制默认地图
                DrawDefaultMap(mainCanvas);
            }
           </script>

    </head>
    <body>
        
        <div id = "buttons">
            <button id = "run-button" onclick="TomcarRun()">开始</button>
            <button id = "pause-button" onclick="">暂停</button>
            <button id = "stop-button" onclick="">停止</button>
            <button id = "clear-button" onclick="ClearMap()">清理地图</button>
            <button id = "load-map-button" onclick="">加载地图</button>
            <button id = "reset-button" onclick="">重置</button>
        </div>

        <div id = "options">
            数量:
            <input v-model="total" placeholder="total">
            出发点:
            <input v-model="car_x" placeholder="location x">
            <input v-model="car_y" placeholder="location y">
        </div>

        <div id = "tomcar">
            <!-- <input type="color" id="color1" /><br/> -->
            <canvas id="main-canvas" width="500" height="500"></canvas>
            <div id="car-starting-point" v-bind:style="{top:car_y + 'px',left:car_x + 'px'}"></div>
        </div>

        <div id = "ranking-list" height="500" width="200">

        </div>

        <script type="text/javascript">

            let options;
            let data = {
                // 数量绑定
                total: 100,
                // 初始位置输入框数据绑定
                car_x: 65,
                car_y: 60,
            };

            require(['vue'],function(Vue){

                options = new Vue({
                    el: '#options',
                    data: data,
                });

                new Vue({
                    el: '#car-starting-point',
                    data: data,
                });
            });

            // 获取canvas 
            var canvas=document.getElementById('main-canvas');
            var runButtton = document.getElementById("run-button");
            var clearButtton = document.getElementById("clear-button");

            // 运行按钮
            function TomcarRun() {

                require(['tomcar','factory'],function(tomcar,factory){
                    var workflow = factory.GetGAWorkFlow(canvas,Number(options.total),Number(options.car_x),Number(options.car_y),10,0);
                    tomcar.TomCarStart(workflow);
                });
                
            
                runButtton.disabled = true;
                clearButtton.disabled = true;

                var carStartingPoint =document.getElementById('car-starting-point');
                carStartingPoint.hidden = true;

            }

            function ClearMap() {
                var gd = canvas.getContext('2d');
                gd.clearRect(0,0,canvas.width,canvas.height);
            }
        </script>

    </body>
</html>